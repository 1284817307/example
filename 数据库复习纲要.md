## 数据库复习纲要

### 第一章 数据库系统概述

#### 数据与数据处理的关系

信息=数据+数据处理

#### 数据库（DB)

##### 特点

数据结构化、数据共享、数据独立性

#### 数据库管理系统（DBMS)

##### 功能

1. 数据库定义功能
2. 数据库操纵功能
3. 数据库保护功能
4. 数据库维护功能
5. 数据字典

##### 组成

1. 语言编译处理程序
2. 系统运行控制程序
3. 系统建立、维护程序
4. 数据字典系统程序

#### 数据库系统（DBS)

##### 组成

数据库、硬件、软件、用户

##### 用户

普通用户、应用程序员、数据管理员

#### 三者关系

DBS包括DB和DBMS

#### 数据库三级模式结构

内模式、外模式、模式

#### 数据库两级映像功能

##### 模式间的映像

外模式/模式映像、模式/内模式映像

##### 两级数据的独立性

数据独立性是指应用程序和数据库的数据结构之间相互独立，不受影响。

数据独立性分成数据独立性和逻辑独立性两个级别。

#### 三级模式两级映像的优点

保证了数据库中的数据具有较高的逻辑独立性和物理独立性。其优点是当数据的逻辑结构变了，用户程序可以不变；当数据的物理结构改变了，应用程序也可以不变。

#### 数据模型

##### 数据模型的分类

- 层次模型
- 网状模型
- 关系模型
- 面向对象模型

##### 三个世界

现实世界、信息世界、机器世界

##### 数据模型三要素

数据结构、数据操作、数据的约束条件

### 第二章 关系数据库

#### 关系模型

##### 组成

数据结构、关系的操作、完整性约束（实体完整性、参照【引用】完整性、用户定义的完整性）

##### 优缺点

待定

#### 关系的定义

关系是笛卡尔积的有限子集，所以关系也是一个二维表。

#### 关系模式和关系数据库模式

##### 关系模式

R(U)或R(A1,A2,A3，…，An)

R(U,F)

R为关系名，A1为属性名

关系模式可形式化地表示为：R(U,D,dom,F)

U为组成关系的属性名的集合，D为U中属性的域，dom为属性和域之间的映像合集，F为关系中属性间的依赖关系集合。

##### 关系数据库模式

一组关系模式的集合叫做关系数据库模式。

#### 关系代数

##### 组成

运算对象、运算符、运算结果。

##### 运算符

集合运算符、专门的关系运算符、比较运算符和逻辑运算符。

##### 自然连接和等值连接的比较

自然连接一定是等值连接，但等值连接不一定是自然连接。

等值连接要求相等的分量，不一定是公共属性；而自然连接要求相等的分量必须是公共属性。

等值连接不把重复的属性除去；而自然连接要把重复的属性除去。

##### 基本运算

并、差、笛卡尔积、选择和投影五中运算为基本运算。

### 第三章  关系数据库标准语言

SQL是 结构化查询语言，主要由四个部分组成

##### 数据定义

用于定义数据库、基本表、视图和索引。

##### 数据操纵

##### 数据控制

包括对基本表和视图的授权、完整性规则的描述、事务控制等。

##### 数据查询

##### 视图的作用

- 减轻普通用户的工作
- 视图是数据库系统的一种安全措施
- 视图可以提高数据的逻辑独立性

### 第五章 关系数据库设计理论

#### 不好的数据库一般存在的问题

存储冗余、插入异常、修改异常、删除异常

#### 函数依赖

$$
X\rightarrow Y且Y\rightarrow X 相互依赖，记做X<->Y
$$



### 第七章 数据库设计

#### 数据库设计的内容

数据库的结构设计、数据库的行为设计、

#### 数据库设计的步骤

1. 系统需求分析阶段
2. 概念结构设计阶段
3. 逻辑结构设计阶段
4. 物理设计阶段
5. 数据库实施阶段
6. 数据库运行与维护阶段

#### 系统需求分析

##### 数据流图和数据字典

数据流图表达了数据和处理过程的关系，能精确地在逻辑上描述系统的功能、输入、输出和数据存储。

数据字典是各类数据描述的集合。包括五个部分：数据项、数据结构、数据流、数据存储和处理。

### 第八章 数据库事务管理

#### 并发操作

丢失修改、读过时数据、读“脏”数据

#### 封锁

##### 排他锁和共享锁

排他锁可读可写，共享锁仅可读

一次加锁锁住的数据单位大小被称为锁的粒度(Granularity)，如果数据单位比较小，为细粒度，否则为粗粒度。

##### 封锁协议

##### 活锁和死锁

#### 数据库恢复

数据备份、日志文件

#### 数据库故障

事务故障、系统故障、介质故障

### 第九章 数据库的安全性与完整性

数据库的安全保护主要包括数据的安全性和数据的完整性。

#### 数据库的安全性

1. 用户标识和鉴定
2. 存取控制
3. 视图机制
4. 审计
5. 操作系统安全保护
6. 数据加密

#### 数据库的完整性

### CREATE

```sql
CREATE Table S
(Snum CHAR(10)NOT NULL UNIQUE,   //列级完整性约束，因为后面定义了是主键，这个约束冗余了，可以删除
 Sname VARCHAR(8),
 Ssex CHAR(2),
 Sage SMALLINT,
 Sphone VARCHAR(20),
 Dnum CHAR(4),
 PRIMARY KEY (Snum),             //表级完整性约束 //CONSTRAINT Uni_Snum UNIQUE(Snum),
 FOREIGN KEY (Dnum) REFERENCES D(Dnum)
);

CHECK 子句可以来保证属性值满足某些条件
CHECK((Cfreq IS NULL)OR (Cfreq BETWEEN 0 AND 10))
```

### ALTER

```sql
增加
ALTER TABLE S ADD Saddress VARCHAR(50);
修改列的属性
ALTER TABLE S ALTER COLUMN Sname CHAR(15);
删除列
ALTER TABLE S DROP COLUMN Sage;
增加完整性约束
ALTER TABLE S
ADD CONSTRAINT Chk_Sage CHECK (Sage > 0 and Sage < 100);
删除完整性约束
ALTER TABLE S
DROP CONSTRAINT Uni_Snum,Chk_Sage;
```

### DROP

```sql
DROP TABLE S;
```

### 索引

```sql
CREATE INDEX idx_Sname ON S(Sname);

CREATE INDEX idx_Cnum_Score ON SC(Cnum,Score DESC);

DROP INDEX idx_Sname ON S;

CLUSTER 可选项，表示该索引为聚簇索引。聚簇索引是指索引的顺序与基本表中的物理顺序一致的索引。
```

### UPDATE

```sql
UPDATE T
SET Tsalary=Tsalary-100
WHERE Dnum IN
(SELECT Dnum
 FROM D
 WHERE Dname='计算机');
```

### VIEW

```sql
CREATE VIEW view_S(Snum,Sname,Cnum,Score)
As SELECT S.Snum,Sname,Cnum,Score
FROM S,SC
WHERE S.Snum=SC.Snum
```

### DELETE

```sql
DELETE FROM SC
WHERE Snum IN
(
SELECT Snum
FROM S
WHERE Sname='lalala'
);
```

### GRANT

```sql
GRANT SELECT,INSERT,UPDATE,DELETE
ON S
TO Admin;
```

### REVOKE

```sql
REVOKE DELETE
ON S
FROM Admin;
```



